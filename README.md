## About

Gradle Metadata Action for Docker Buildx Bake.

## Usage

### Bake definition

This action also handles a bake definition file that can be used with the Docker Bake action. You just have to declare an empty target named `gradle-metadata-action` and inherit from it.

```hcl
// docker-bake.hcl
target "docker-metadata-action" {}
target "gradle-metadata-action" {}

target "build" {
  inherits = ["docker-metadata-action", "gradle-metadata-action"]
  context = "./"
  dockerfile = "Dockerfile"
  platforms = [
    "linux/amd64",
    "linux/arm/v6",
    "linux/arm/v7",
    "linux/arm64",
    "linux/386"
  ]
}
```

```yml
name: ci

on:
  push:
    branches:
      - 'main'
    tags:
      - 'v*'
  pull_request:
    branches:
      - 'main'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      - name: Docker meta
        id: meta
        uses: docker/metadata-action@v4
        with:
          images: |
            name/app
          tags: |
            type=ref,event=branch
            type=ref,event=pr
            type=semver,pattern={{version}}
            type=semver,pattern={{major}}.{{minor}}
            type=sha

      - name: Gradle meta
        id: gradle-meta
        uses: dockerbakery/gradle-metadata-action@v2

      - uses: docker/bake-action@v2
        with:
          files: |
            ./docker-bake.hcl
            ${{ steps.meta.outputs.bake-file }}
            ${{ steps.gradle-meta.outputs.bake-file }}
          targets: build
```

Content of `${{ steps.gradle-meta.outputs.bake-file }}` file, generated by the Gradle Metadata Action:

```json
{
  "group": {
    "default": {
      "targets": [
        "gradle-metadata-action"
      ]
    }
  },
  "target": {
    "gradle-metadata-action": {
      "args": {
        "GRADLE_VERSION": "7.6",
        "GRADLE_PROJECT_NAME": "example-project",
        "GRADLE_PROJECT_DESCRIPTION": "example-project",
        "GRADLE_PROJECT_GROUP": "com.example",
        "GRADLE_PROJECT_PROFILE": "dev",
        "GRADLE_PROJECT_VERSION": "1.0.0-SNAPSHOT",
        "GRADLE_PROJECT_PROFILE": "production",
        "GRADLE_BUILD_ARTIFACT_ID": "example-project-1.0.0-SNAPSHOT",
        "GRADLE_BUILD_ARTIFACT": "example-project-1.0.0-SNAPSHOT.jar",
        "GRADLE_TARGET_COMPATIBILITY": "11",
        "GRADLE_SOURCE_COMPATIBILITY": "11",
        "JAVA_VENDOR": "AdoptOpenJDK",
        "JAVA_VERSION": "11.0.11",
      }
    }
  }
}
```

## Input

Following inputs can be used as `step.with` keys

| Name      | Type   | Description                                                                            |
| --------- | ------ | -------------------------------------------------------------------------------------- |
| `context` | String | Where to get context data. Allowed options are: workflow (default "current directory). |
| `version` | String | Set the version of the Gradle project (override the `version` property)                |

## Output

Following outputs can be used as `steps.<step_id>.outputs` keys

| Name        | Type   | Description                                                                 |
| ----------- | ------ | --------------------------------------------------------------------------- |
| `name`      | String | Name of the Gradle project.                                                 |
| `version`   | String | Version of the Gradle project.                                              |
| `source-compatibility` | String | Source compatibility of the Gradle project. |
| `target-compatibility` | String | Target compatibility of the Gradle project. |
| `bake-file` | String | Path to the generated bake file. Default is `./gradle-metadata-bake.json`. |


## Resources

- [GitHub Action Environment variables](https://docs.github.com/en/actions/learn-github-actions/environment-variables)
- [Workflow commands for GitHub Actions](https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions)
- [Bake File Definitions](https://github.com/docker/buildx/blob/master/docs/guides/bake/file-definition.md)
